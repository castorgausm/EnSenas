{% extends 'base.html' %}
{% load static %}

{% block title %}Lección 2{% endblock %}

{% block navlinks %}
    <li><a href="{% url 'home' %}">Hogar</a></li>
    <li><a href="{% url 'manual' %}">Manual</a></li>
    <li><a href="{% url 'lessons_list' %}">Lecciones</a></li>
    <li><a href="{% url 'profile' %}" class="purplebutton"><span>Perfil</span></a></li>
    <script src="{% static 'js/lesson_2.js' %}"></script>
{% endblock %}

{% block main %}
    <div class="row_five">
        <div class="content">
            <div class="content-main">
                <ul>
                    <div class="video-capsules">
                        <div class="video-item">
                            <video controls>
                                <source src="{% static 'videos/quetegusta.mp4' %}" type="video/mp4">
                                Tu navegador no soporta la etiqueta de video.
                            </video>
                        </div>
                    </div>
                    {% for video in lesson_videos %}
                    <div class="video-capsules">
                        <div class="video-item">
                            <video controls>
                                <source src="{{ video.url }}" type="video/mp4">
                                Tu navegador no soporta la etiqueta de video.
                            </video>
                            <p>{{ video.lesson.title }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </ul>
                <!-- <p>{{ lesson.question }}</p> -->
                <!-- Input for user response -->
                <!-- <input type="text" id="user-response" placeholder="Escribe tu respuesta"> -->
                               
                <!-- Button to submit response -->
                <!-- <button id="submit-response" data-lesson-id="{{ lesson.id }}">Enviar Respuesta</button> -->
                
                <!-- Area to display result -->
                <div id="response-result"></div>
               
                <script>
                document.getElementById('submit-response').addEventListener('click', function() {
                    const userResponse = document.getElementById('user-response').value;
                    const lessonId = this.getAttribute('data-lesson-id');
               
                    fetch(`responder/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body:JSON.stringify({
                                           'respuesta': userResponse
                                       }) 
                    })
                    .then(response => response.json())
                                   .then(data => {
                                       const resultDiv = document.getElementById('response-result');
                                       if (data.correct) {
                                           resultDiv.innerHTML = 'Respuesta Correcta!';
                                           resultDiv.style.color = 'green';
                                           window.location.href = `/lecciones/${Number(lessonId) + 1}/`;
                                       } else {
                                           resultDiv.innerHTML = 'Respuesta Incorrecta';
                                           resultDiv.style.color = 'red';
                                       }
                                   })
                                   .catch(error => {
                                       console.error('Error:', error);
                                   });
                });
                </script>
                <div class="container">
                    <div class="instructions" id="instructionsContainer">
                    </div>
                    <button id="checkOrderButton" class="yellowbutton">Verificar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-container">
        <div class="word-container" id="wordContainer">
            <div class="word" id="word1" draggable="true">A tí</div>
            <div class="word" id="word2" draggable="true">qué es</div>
            <div class="word" id="word3" draggable="true">lo que</div>
            <div class="word" id="word4" draggable="true">te gusta</div>
        </div>
    </div>
    <audio id="errorSound" src="{% static 'sounds/error-sound.mp3' %}" preload="auto"></audio>
    <audio id="correctSound" src="{% static 'sounds/correct-sound.mp3' %}" preload="auto"></audio>
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/lesson_2.js' %}"></script>
{% endblock %}